-- MySQL Script generated by MySQL Workbench
-- Sun Jan 14 18:08:48 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';


-- -----------------------------------------------------
-- Schema testing_system
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `testing_system` DEFAULT CHARACTER SET utf8 ;
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Table `testing_system`.`topic`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`topic` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(45) NOT NULL,
  `info` TEXT NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 5
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`question`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`question` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `question` TEXT NOT NULL,
  `creationDate` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `topic_id` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  INDEX `fk_questions_topic1_idx` (`topic_id` ASC),
  CONSTRAINT `fk_questions_topic1`
    FOREIGN KEY (`topic_id`)
    REFERENCES `testing_system`.`topic` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 9
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`options`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`options` (
  `id` INT(10) NOT NULL AUTO_INCREMENT,
  `optionText` TEXT NOT NULL,
  `score` INT(11) NOT NULL,
  `isCorrect` TINYINT(4) NOT NULL,
  `comment` TEXT NULL DEFAULT NULL,
  `question_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  INDEX `fk_options_questions1_idx` (`question_id` ASC),
  CONSTRAINT `fk_options_questions1`
    FOREIGN KEY (`question_id`)
    REFERENCES `testing_system`.`question` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
AUTO_INCREMENT = 12
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`test`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`test` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  `topic_id` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`id`, `topic_id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  INDEX `fk_test_topic1_idx` (`topic_id` ASC),
  CONSTRAINT `fk_test_topic1`
    FOREIGN KEY (`topic_id`)
    REFERENCES `testing_system`.`topic` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`question_test`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`question_test` (
  `question_id` INT(11) NOT NULL,
  `test_id` INT(11) NOT NULL,
  `topic_id` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`question_id`, `test_id`, `topic_id`),
  INDEX `fk_question_has_test_test1_idx` (`test_id` ASC, `topic_id` ASC),
  INDEX `fk_question_has_test_question1_idx` (`question_id` ASC),
  CONSTRAINT `fk_question_has_test_question1`
    FOREIGN KEY (`question_id`)
    REFERENCES `testing_system`.`question` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_question_has_test_test1`
    FOREIGN KEY (`test_id` , `topic_id`)
    REFERENCES `testing_system`.`test` (`id` , `topic_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`user` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `firstName` VARCHAR(45) NOT NULL,
  `lastName` VARCHAR(45) NOT NULL,
  `login` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NOT NULL,
  `role` ENUM('ADMIN', 'STUDENT') NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 16
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `testing_system`.`user_test`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`user_test` (
  `user_id` INT(11) NOT NULL,
  `test_id` INT(11) NOT NULL,
  `topic_id` INT(10) UNSIGNED NOT NULL,
  PRIMARY KEY (`user_id`, `test_id`, `topic_id`),
  INDEX `fk_user_has_test_test1_idx` (`test_id` ASC, `topic_id` ASC),
  INDEX `fk_user_has_test_user1_idx` (`user_id` ASC),
  CONSTRAINT `fk_user_has_test_user1`
    FOREIGN KEY (`user_id`)
    REFERENCES `testing_system`.`user` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_user_has_test_test1`
    FOREIGN KEY (`test_id` , `topic_id`)
    REFERENCES `testing_system`.`test` (`id` , `topic_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `mydb`.`user_response`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `testing_system`.`user_response` (
  `id` INT NOT NULL,
  `options_id` INT(10) NOT NULL,
  `question_id` INT(11) NOT NULL,
  `test_id` INT(11) NOT NULL,
  `topic_id` INT(10) UNSIGNED NOT NULL,
  `user_id` INT(11) NOT NULL,
  `totalScore` INT NOT NULL,
  `dataPassed` TIMESTAMP NOT NULL;

  PRIMARY KEY (`id`),
  INDEX `fk_user_response_options_idx` (`options_id` ASC),
  INDEX `fk_user_response_question_test1_idx` (`question_id` ASC, `test_id` ASC, `topic_id` ASC),
  INDEX `fk_user_response_user_test1_idx` (`user_id` ASC),
  CONSTRAINT `fk_user_response_options`
    FOREIGN KEY (`options_id`)
    REFERENCES `testing_system`.`options` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_user_response_question_test1`
    FOREIGN KEY (`question_id` , `test_id` , `topic_id`)
    REFERENCES `testing_system`.`question_test` (`question_id` , `test_id` , `topic_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_user_response_user_test1`
    FOREIGN KEY (`user_id`)
    REFERENCES `testing_system`.`user_test` (`user_id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;



SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


INSERT INTO `testing_system`.`topic` (`id`, `title`, `info`) VALUES ('1', 'Limits', 'The limit of a function at a point  in its domain (if it exists) is the value that the function approaches as its argument approaches  The concept of a limit is the fundamental concept of calculus and analysis. It is used to define the derivative and the definite integral, and it can also be used to analyze the local behavior of functions near points of interest.');
INSERT INTO `testing_system`.`topic` (`id`, `title`, `info`) VALUES ('2', ' Differentiation', 'In the first section of this chapter we saw the definition of the derivative and we computed a couple of derivatives using the definition. ');
INSERT INTO `testing_system`.`topic` (`id`, `title`, `info`) VALUES ('3', 'Integration', 'the operation of finding the integral of a function or equation, especially solving a differential equation.');

INSERT INTO `testing_system`.`question` (`id`, `question`, `creationDate`, `topic_id`) VALUES ('1', 'Choose equation of tangent line', '14.01.2018', '2');
INSERT INTO `testing_system`.`question` (`id`, `question`, `creationDate`, `topic_id`) VALUES ('2', 'Definition of integral', '14.01.2018', '3');

INSERT INTO `testing_system`.`test` (`id`, `name`, `topic_id`) VALUES ('1', 'Theory of Integration', '3');
INSERT INTO `testing_system`.`test` (`id`, `name`, `topic_id`) VALUES ('2', 'Basic points on differentiation', '2');

INSERT INTO `testing_system`.`question_test` (`question_id`, `test_id`, `topic_id`) VALUES ('1', '1', '2');
INSERT INTO `testing_system`.`question_test` (`question_id`, `test_id`, `topic_id`) VALUES ('2', '2', '3');

INSERT INTO `testing_system`.`user` (`id`, `firstName`, `lastName`, `login`, `password`, `email`, `role`) VALUES ('1', 'Борис', 'Пчелкин', 'Baris', '1278', 'Boris@gmail', 'STUDENT');
INSERT INTO `testing_system`.`user` (`id`, `firstName`, `lastName`, `login`, `password`, `email`, `role`) VALUES ('2', 'Анна', 'Зюзя', 'Enn', '1456', 'Ann@gmail.com', 'STUDENT');
INSERT INTO `testing_system`.`user` (`id`, `firstName`, `lastName`, `login`, `password`, `email`, `role`) VALUES ('3', 'Admin', 'Admin', 'admin', '12345', 'admin@gmail.com', 'ADMIN');

INSERT INTO `testing_system`.`options` (`id`, `optionText`, `score`, `isCorrect`, `question_id`) VALUES ('1', 'y=kx+b', '0', '0', '1');
INSERT INTO `testing_system`.`options` (`id`, `optionText`, `score`, `isCorrect`, `question_id`) VALUES ('2', 'y-y0=f(x0)(x-x0)', '1', '1', '1');
INSERT INTO `testing_system`.`options` (`id`, `optionText`, `score`, `isCorrect`, `comment`, `question_id`) VALUES ('3', 'slope of the graph of f at x = x 0 ', '1', '1', 'You are right', '3');
INSERT INTO `testing_system`.`options` (`id`, `optionText`, `score`, `isCorrect`, `question_id`) VALUES ('4', 'simply point', '0', '0', '3');

INSERT INTO `testing_system`.`user_response` (`id`, `options_id`, `question_id`, `test_id`, `topic_id`, `user_id`, `totalScore`, `dataPassed`) VALUES ('1', '1', '1', '2', '2', '1', '0', '14.01.2018');
